<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Airport Info Viewer</title>
</head>
<body>
  <h2>Select Airport</h2>

  <label for="countrySelect">Country:</label><br>
  <select id="countrySelect">
    <option value="">-- Select Country --</option>
  </select><br><br>

  <label for="stateSelect">State:</label><br>
  <select id="stateSelect" disabled>
    <option value="">-- Select State --</option>
  </select><br><br>

  <label for="airportSelect">Airport:</label><br>
  <select id="airportSelect" disabled>
    <option value="">-- Select Airport --</option>
  </select><br><br>

  <div id="airportInfo"></div>

  <script>
    let airportData = {};
    const countrySelect = document.getElementById("countrySelect");
    const stateSelect = document.getElementById("stateSelect");
    const airportSelect = document.getElementById("airportSelect");
    const airportInfo = document.getElementById("airportInfo");

    async function loadAirportData() {
      const res = await fetch("https://raw.githubusercontent.com/choikk/xc_planner/refs/heads/main/json_data/airport_base_info_with_runways_airspace.json");
      airportData = await res.json();
      populateCountries();
    }

    function populateCountries() {
      const countries = new Set();
      for (const code in airportData) {
        const country = airportData[code].country?.trim().toUpperCase();
        if (country) countries.add(country);
      }

      Array.from(countries).sort().forEach(c => {
        const option = document.createElement("option");
        option.value = c;
        option.textContent = c;
        countrySelect.appendChild(option);
      });

      countrySelect.addEventListener("change", populateStates);
    }

    function populateStates() {
      stateSelect.innerHTML = '<option value="">-- Select State --</option>';
      airportSelect.innerHTML = '<option value="">-- Select Airport --</option>';
      stateSelect.disabled = true;
      airportSelect.disabled = true;
      airportInfo.innerHTML = "";

      const selectedCountry = countrySelect.value;
      if (!selectedCountry) return;

      const states = new Set();
      for (const code in airportData) {
        const airport = airportData[code];
        if (airport.country?.toUpperCase() === selectedCountry) {
          states.add(airport.state?.toUpperCase());
        }
      }

      Array.from(states).sort().forEach(s => {
        const option = document.createElement("option");
        option.value = s;
        option.textContent = s;
        stateSelect.appendChild(option);
      });

      stateSelect.disabled = false;
      stateSelect.addEventListener("change", populateAirports);
    }

    function populateAirports() {
      airportSelect.innerHTML = '<option value="">-- Select Airport --</option>';
      airportInfo.innerHTML = "";
      airportSelect.disabled = true;

      const selectedCountry = countrySelect.value;
      const selectedState = stateSelect.value;

      if (!selectedCountry || !selectedState) return;

      const filtered = Object.entries(airportData).filter(([code, airport]) => 
        airport.country?.toUpperCase() === selectedCountry &&
        airport.state?.toUpperCase() === selectedState
      );

      filtered.sort((a, b) => a[0].localeCompare(b[0])).forEach(([code, airport]) => {
        const option = document.createElement("option");
        option.value = code;
        option.textContent = `${code} - ${airport.airport_name}`;
        airportSelect.appendChild(option);
      });

      airportSelect.disabled = false;
      airportSelect.addEventListener("change", showAirportInfo);
    }

    function showAirportInfo() {
      const code = airportSelect.value;
      if (!code || !airportData[code]) {
        airportInfo.innerHTML = "";
        return;
      }

      const a = airportData[code];
      const runways = a.runways.map(rwy => 
        `Runway ${rwy.rwy_id}: ${rwy.length} ft x ${rwy.width} ft, ${rwy.surface} (${rwy.condition})`
      ).join("<br>");

      airportInfo.innerHTML = `
        <h3>${code} - ${a.airport_name}</h3>
        <p><strong>City:</strong> ${a.city}<br>
        <strong>State:</strong> ${a.state}<br>
        <strong>Country:</strong> ${a.country}<br>
        <strong>Latitude:</strong> ${a.lat}<br>
        <strong>Longitude:</strong> ${a.lon}<br>
        <strong>Airspace:</strong> ${a.airspace}<br>
        <strong>Remarks:</strong> ${a.remarks || "None"}</p>
        <p><strong>Runways:</strong><br>${runways}</p>
      `;
    }

    loadAirportData();
  </script>
</body>
</html>
